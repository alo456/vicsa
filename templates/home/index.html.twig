{% extends 'base.html.twig' %}
{% block title %} Dashboard {% endblock %}
{% block stylesheets %}
    <link href="{{asset('css/vendors/jquery-ui.css')}}" rel="stylesheet">
    <style>
        #report {  width: 49%; display:block; float : left;}
        #report2 {  width: 50%; display:block;float : left; }
        select {
            padding: 0.375rem 3.75rem 0.375rem 0.75rem !important;
        }
    </style>
{% endblock %}


{% block body %}
    {% embed 'menu.html.twig' %}
        {% block content %}
            <div id="pending" class="ui-widget-content">
                <h3 class="ui-widget-header">Notas Pendientes</h3>
                <button  style=" float: right" type="button" class="btn btn-link" id="generate"><i class="fas fa-file-invoice"></i>&nbspGenerar Excel</button> 
                
                </br>
                <table id="dtBasicExample" class="table"  cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th class="th-sm">Línea</th>
                            <th class="th-sm">Descripción</th>
                            <th class="th-sm">Precio</th>
                            <th class="contract th-sm">Días</th>
                            <th class="th-sm">Plan</th>
                            <th class="account th-sm">Cuenta</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key, pend in pends %}
                            <tr>
                                <td> <font color="#fff"> {{key}} </font></td>
                                <td> <font color="#fff"> {{pend.description}} </font></td>
                                <td> <font color="#fff"> {{pend.price}} </font></td>
                                <td> <font color="#fff"> {{pend.days}} </font></td>
                                <td> <font color="#fff"> {{pend.plan}} </font></td> 
                                <td> <font color="#fff"> {{pend.account}} </font></td>   
                            </tr>   
                        {% endfor %}
                        <tr>
                            <td> <font color="#fff">9512234568 </font> </td>
                            <td> <font color="#fff"> HUAWEI LTE </font></td>
                            <td> <font color="#fff">$5,400 </font></td>
                            <td> <font color="#fff">5</font></td>
                            <td> <font color="#fff">Plan </font></td>
                            <td> <font color="#fff">Activacion </font></td>
                        </tr>
                        <tr>
                            <td> <font color="#fff">9512234568 </font> </td>
                            <td> <font color="#fff"> HUAWEI LTE </font></td>
                            <td> <font color="#fff">$5,400 </font></td>
                            <td> <font color="#fff">10</font></td>
                            <td> <font color="#fff">Plan </font></td>
                            <td> <font color="#fff">Activacion </font></td>
                        </tr>
                        <tr>
                            <td> <font color="#fff">9512234568 </font> </td>
                            <td> <font color="#fff"> HUAWEI LTE </font></td>
                            <td> <font color="#fff">$5,400 </font></td>
                            <td> <font color="#fff">15</font></td>
                            <td> <font color="#fff">Plan </font></td>
                            <td> <font color="#fff">Activacion </font></td>
                        </tr>
                        <tr>
                            <td> <font color="#fff">9512234568 </font> </td>
                            <td> <font color="#fff"> HUAWEI LTE </font></td>
                            <td> <font color="#fff">$5,400 </font></td>
                            <td> <font color="#fff">20</font></td>
                            <td> <font color="#fff">Plan </font></td>
                            <td> <font color="#fff">Activacion </font></td>
                        </tr>
                        <tr>
                            <td> <font color="#fff">9512234568 </font> </td>
                            <td> <font color="#fff"> HUAWEI LTE </font></td>
                            <td> <font color="#fff">$5,400 </font></td>
                            <td> <font color="#fff">25</font></td>
                            <td> <font color="#fff">Plan </font></td>
                            <td> <font color="#fff">Activacion </font></td>
                        </tr>
                    </tbody>


            <div class="row mb-2">
                <div class="col-sm-12">
                    <div id="pending" class="card">
                        <div class="card-header" > Notas Por Pagar</div>
                        <div class="card-body">
                            <table id="dtBasicExample" class="table table-striped table-bordered nowrap"  cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th class="th-sm">Línea</th>
                                        <th class="th-sm">Descripción</th>
                                        <th class="th-sm">Precio</th>
                                        <th class="contract th-sm">Contrato</th>
                                        <th class="th-sm">Nombre del Plan</th>
                                        <th class="account th-sm">Cuenta</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for key, pend in pends %}
                                        <tr>
                                            <td> {{key}} </td>
                                            <td> {{pend[0]}} </td>
                                            <td> {{pend[1]}} </td>
                                            <td> {{pend[2]}} </td>
                                            <td> {{pend[3]}} </td>  
                                        </tr>   
                                    {% endfor %}
                                    <tr>
                                        <td> 9512234568 <span class="badge badge-warning">Pendiente</span></td>
                                        <td>  HUAWEI LTE </font></td>
                                        <td> $5,400 </font></td>
                                        <td> Contrato</font></td>
                                        <td> Plan </font></td>
                                        <td> Activacion </font></td>
                                    </tr>
                                    <tr>
                                        <td> 9512234568 <span class="badge badge-warning">Pendiente</span></td>
                                        <td>  HUAWEI LTE </font></td>
                                        <td> $5,400 </font></td>
                                        <td> Contrato</font></td>
                                        <td> Plan </font></td>
                                        <td> Activacion </font></td>
                                    </tr>
                                    <tr>
                                        <td> 9512234568 <span class="badge badge-warning">Pendiente</span></td>
                                        <td>  HUAWEI LTE </font></td>
                                        <td> $5,400 </font></td>
                                        <td> Contrato</font></td>
                                        <td> Plan </font></td>
                                        <td> Activacion </font></td>
                                    </tr>
                                    <tr>
                                        <td> 9512234568 <span class="badge badge-warning">Pendiente</span></td>
                                        <td>  HUAWEI LTE </font></td>
                                        <td> $5,400 </font></td>
                                        <td> Contrato</font></td>
                                        <td> Plan </font></td>
                                        <td> Activacion </font></td>
                                    </tr>
                                    <tr>
                                        <td> 9512234568 <span class="badge badge-warning">Pendiente</span></td>
                                        <td>  HUAWEI LTE </font></td>
                                        <td> $5,400 </font></td>
                                        <td> Contrato</font></td>
                                        <td> Plan </font></td>
                                        <td> Activacion </font></td>
                                    </tr>
                                </tbody>

                            </table>
                        </div>
                    </div>
                </div>
            </div> 

            <div id="report" class="card ui-widget-content mb-2 mr-1">

                <div class="card-body"> 
                    <div class="row" >
                        <div class="col">
                            <h5 class="card-title">Reporte Semanal</h5>
                        </div>
                    </div>
                    <div class="chart-container"
                        <canvas id="canvas"></canvas>
                    </div>
                </div>
            </div>
            <div id="report2" class="card ui-widget-content mb-2">
                <div class="card-body"> 
                    <div class="row" >
                        <div class="col">
                            <h5 class="card-title">Reporte Mensual</h5>
                        </div>
                    </div>
                    <div class="chart-container"
                        <canvas id="canvas2"></canvas>
                    </div>
                </div>
            </div> 



        {% endblock %}
    {% endembed %}
{% endblock %}



{% block javascripts %}

    <script src="{{asset('js/vendors/jquery-ui.js')}}"></script>
    <script>
        var lineChartData = {
            labels: ['LUNES', 'MARTES', 'MIERCOLES', 'JUEVES', 'VIERNES', 'SABADO', 'DOMINGO'],
            datasets: [{
                    label: 'VENTAS',
                    borderColor: window.chartColors.red,
                    backgroundColor: window.chartColors.red,
                    fill: false,
                    data: [
        {{ sales[1] }},
        {{ sales[2] }},
        {{ sales[3] }},
        {{ sales[4] }},
        {{ sales[5] }},
        {{ sales[6] }},
        {{ sales[7] }}
                        ],
                        yAxisID: 'y-axis-1',
                    }, {
                        label: 'COMPRAS ALMACEN',
                        borderColor: window.chartColors.blue,
                        backgroundColor: window.chartColors.blue,
                        fill: false,
                        data: [
        {{ purchases[1] }},
        {{ purchases[2] }},
        {{ purchases[3] }},
        {{ purchases[4] }},
        {{ purchases[5] }},
        {{ purchases[6] }},
        {{ purchases[7] }}
                        ],
                        yAxisID: 'y-axis-2'
                    }]
            };
            window.onload = function () {
                var ctx = document.getElementById('canvas').getContext('2d');
                var ctx2 = document.getElementById('canvas2').getContext('2d');
                window.myLine = Chart.Line(ctx, {
                    data: lineChartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        hoverMode: 'index',
                        stacked: false,
                        scales: {
                            yAxes: [{
                                    type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                                    display: true,
                                    position: 'left',
                                    id: 'y-axis-1',
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }, {
                                    type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                                    display: true,
                                    position: 'right',
                                    id: 'y-axis-2',
                                    ticks: {
                                        beginAtZero: true
                                    },
                                    // grid line settings
                                    gridLines: {
                                        drawOnChartArea: false, // only want the grid lines for one axis to show up
                                    },
                                },
                            ],
                        }
                    }
                });
                window.myLine = Chart.Line(ctx2, {
                    data: lineChartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        hoverMode: 'index',
                        stacked: false,
                        scales: {
                            yAxes: [{
                                    type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                                    display: true,
                                    position: 'left',
                                    id: 'y-axis-1',
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }, {
                                    type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                                    display: true,
                                    position: 'right',
                                    id: 'y-axis-2',
                                    ticks: {
                                        beginAtZero: true
                                    },
                                    // grid line settings
                                    gridLines: {
                                        drawOnChartArea: false, // only want the grid lines for one axis to show up
                                    },
                                },
                            ],
                        }
                    }
                });
            };
    </script>
    <script>


        $(document).ready(function () {

            $.fn.dataTable.Buttons.defaults.dom.button.className = 'btn';
            var table = $('#dtBasicExample')
                    .DataTable({
                        dom: "<'row no-gutters'<'col-sm-12 col-md-2'l><'col-sm-12 col-md-7'f><'col-sm-12 col-md-3 text-right'B>>" +
                                "<'row'<'col-sm-12'tr>>" +
                                "<'row'<'col-sm-12 col-md-12'p>>",
                        buttons: [
                            {
                                text: '<i class="fas fa-file-invoice-dollar"></i> <span class="badge badge-light">4</span>',
                                className: 'btn btn-info disabled'
                            },
                            {
                                text: '<i class="fas fa-dollar-sign"></i> 15,000',
                                className: 'btn btn-success disabled'
                            },
                            {
                                text: '<i class="fas fa-download"></i>',
                                className: 'btn btn-primary'
                            }

                        ],
                        "lengthMenu": [[10, 25, 50, -1], [10 + " Registros", 25 + " Registos", 50 + " Registos", "Todos"]],
                        responsive: true
                    });
            new $.fn.dataTable.FixedHeader(table);
            table.buttons().container()
                    .appendTo('#dtBasicExample_wrapper .col-md-6:eq(0)');
            $('.dt-buttons').removeClass('btn-group');
            $('#dtBasicExample_filter').removeClass('dataTables_filter');
            $('#dtBasicExample_filter').children().addClass('input-group col-md-6');
            $('#dtBasicExample_filter').children().append("<span class='input-group-append'><button class='btn btn-outline-secondary border-left-0 border' type='button'><i class='fa fa-search'></i></button></span>");

        });
        $(function () {
            $("#report").resizable({
                minHeight: 236,
                minWidth: 474,
                stop: function (e, ui) {
                    var parent = ui.element.parent().parent();
                    ui.element.css({
                        width: ui.element.width() / parent.width() * 100 + "%",
                    });
                }
            });
        });
        $(function () {
            $("#report2").resizable({
                minHeight: 235,
                minWidth: 474,
                stop: function (e, ui) {
                    var parent = ui.element.parent();
                    ui.element.css({
                        width: ui.element.width() / parent.width() * 100 + "%"
                    });
                }
            });
        });
        $("#generate").click(function () {
            var result = [];
            $($('#dtBasicExample').DataTable().columns(".account").data()[0]).each(function () {
                var account = this.match(/(?<=\>).*(?=\<)/g);
                account = $.trim(account);
                result.push(account);
            });
            console.log(result);
            $.ajax({
                url: '{{ (path('generate')) }}',
                type: "POST",
                dataType: "json",
                data: {
                    "accounts": "result"
                },
                async: true
                        /*success: function (data)
                         {
                         console.log(data)
                         $('div#ajax-results').html(data.output);
                         
                         }*/
            });
            return false;
        });
    </script>

{% endblock %}

